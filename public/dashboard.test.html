<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Button Tests</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .test-result {
      padding: 16px;
      margin: 8px 0;
      border-radius: 8px;
      font-weight: 500;
    }
    .test-pass {
      background-color: #dcfce7;
      color: #166534;
      border: 1px solid #86efac;
    }
    .test-fail {
      background-color: #fee2e2;
      color: #991b1b;
      border: 1px solid #fca5a5;
    }
  </style>
</head>
<body class="bg-slate-50 p-8">
  <div class="max-w-2xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">Dashboard Button Regression Tests</h1>
    
    <div id="test-results"></div>
    
    <div class="mt-8 p-6 bg-white rounded-lg border">
      <h2 class="text-xl font-bold mb-4">Test Actions</h2>
      <a href="/" class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 mr-2">
        Home Page
      </a>
      <a href="/dashboard" class="inline-block px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
        Dashboard Page
      </a>
    </div>
  </div>

  <script>
    const tests = [
      {
        name: "Dashboard button exists in home page",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes('href="/dashboard"') && html.includes('aria-label="View monitoring dashboard"');
        }
      },
      {
        name: "Dashboard button is an anchor tag (not button)",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const dashboardLinkMatch = html.match(/<a[^>]*href="\/dashboard"[^>]*>/);
          return dashboardLinkMatch && !dashboardLinkMatch[0].includes('type="button"');
        }
      },
      {
        name: "Dashboard button has proper Tailwind classes",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const dashboardLink = html.match(/<a[^>]*href="\/dashboard"[^>]*>/);
          const classes = ["p-2", "rounded-lg", "bg-slate-200", "inline-flex", "items-center"];
          const hasClasses = dashboardLink && classes.every(c => dashboardLink[0].includes(c));
          return hasClasses;
        }
      },
      {
        name: "Dashboard button has SVG icon",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const dashboardSection = html.match(/<a[^>]*href="\/dashboard"[^>]*>[\s\S]*?<\/a>/);
          return dashboardSection && dashboardSection[0].includes("<svg");
        }
      },
      {
        name: "Dashboard button has hover styles",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const dashboardLink = html.match(/<a[^>]*href="\/dashboard"[^>]*>/);
          return dashboardLink && dashboardLink[0].includes("hover:bg-slate-300");
        }
      },
      {
        name: "Dashboard button has dark mode support",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const dashboardLink = html.match(/<a[^>]*href="\/dashboard"[^>]*>/);
          return dashboardLink && dashboardLink[0].includes("dark:bg-slate-800");
        }
      },
      {
        name: "Dashboard button has focus styles",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const dashboardLink = html.match(/<a[^>]*href="\/dashboard"[^>]*>/);
          return dashboardLink && dashboardLink[0].includes("focus:ring-2") && dashboardLink[0].includes("focus:ring-accent");
        }
      },
      {
        name: "Dashboard button is responsive (sm breakpoint)",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const dashboardLink = html.match(/<a[^>]*href="\/dashboard"[^>]*>/);
          return dashboardLink && dashboardLink[0].includes("sm:p-2.5");
        }
      },
      {
        name: "Dashboard button has proper accessibility label",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const dashboardLink = html.match(/<a[^>]*href="\/dashboard"[^>]*>/);
          return dashboardLink && dashboardLink[0].includes('aria-label="View monitoring dashboard"');
        }
      },
      {
        name: "Dashboard page is accessible at /dashboard",
        test: async () => {
          const response = await fetch("/dashboard");
          return response.ok && response.status === 200;
        }
      },
      {
        name: "Dashboard page contains metrics endpoint",
        test: async () => {
          const response = await fetch("/dashboard");
          const html = await response.text();
          return html.includes('fetch("/metrics")') || html.includes("fetch('/metrics')");
        }
      },
      {
        name: "Dashboard page has proper heading structure",
        test: async () => {
          const response = await fetch("/dashboard");
          const html = await response.text();
          return html.includes("<h1") && html.includes("Monitoring Dashboard");
        }
      },
      {
        name: "Dashboard page has stats grid",
        test: async () => {
          const response = await fetch("/dashboard");
          const html = await response.text();
          const hasStatsGrid = html.includes('id="total-requests"') && 
                               html.includes('id="error-rate"') &&
                               html.includes('id="cache-hit"') &&
                               html.includes('id="avg-latency"');
          return hasStatsGrid;
        }
      },
      {
        name: "Dashboard page has backend list section",
        test: async () => {
          const response = await fetch("/dashboard");
          const html = await response.text();
          return html.includes('id="backend-list"');
        }
      },
      {
        name: "Dashboard page has responsive grid classes",
        test: async () => {
          const response = await fetch("/dashboard");
          const html = await response.text();
          return html.includes("grid-cols-1") && html.includes("md:grid-cols-2") && html.includes("lg:grid-cols-4");
        }
      },
      {
        name: "Dashboard page has dark mode classes",
        test: async () => {
          const response = await fetch("/dashboard");
          const html = await response.text();
          return html.includes("dark:text-white") && html.includes("dark:bg-");
        }
      },
      {
        name: "Dashboard back link exists",
        test: async () => {
          const response = await fetch("/dashboard");
          const html = await response.text();
          return html.includes('href="/"') && html.includes("Back to Home");
        }
      },
      {
        name: "Dashboard back link has proper styling",
        test: async () => {
          const response = await fetch("/dashboard");
          const html = await response.text();
          const backLink = html.match(/<a[^>]*href="\/"[^>]*>[\s\S]*?Back to Home[\s\S]*?<\/a>/);
          return backLink && backLink[0].includes("text-accent") && backLink[0].includes("hover:");
        }
      },
      {
        name: "Dashboard page has auto-refresh mechanism",
        test: async () => {
          const response = await fetch("/dashboard");
          const html = await response.text();
          return html.includes("setInterval") && html.includes("10000");
        }
      },
      {
        name: "Metrics endpoint returns valid JSON",
        test: async () => {
          const response = await fetch("/metrics");
          if (!response.ok) return false;
          const data = await response.json();
          return data.gateway && data.backends && data.timestamp;
        }
      },
      {
        name: "Metrics response has all required gateway properties",
        test: async () => {
          const response = await fetch("/metrics");
          const data = await response.json();
          const props = ["totalRequests", "totalErrors", "errorRate", "cacheHitRate", "averageLatencyMs"];
          return props.every(p => p in data.gateway);
        }
      },
      {
        name: "Metrics response has backend array",
        test: async () => {
          const response = await fetch("/metrics");
          const data = await response.json();
          return Array.isArray(data.backends);
        }
      },
      {
        name: "Footer dashboard link exists",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const footerMatch = html.match(/<footer[\s\S]*?<\/footer>/);
          return footerMatch && footerMatch[0].includes('href="/dashboard"');
        }
      },
      {
        name: "Footer dashboard link has accessible text",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const footerMatch = html.match(/<footer[\s\S]*?<\/footer>/);
          return footerMatch && footerMatch[0].includes(">Dashboard<");
        }
      },
      {
        name: "All dashboard links point to /dashboard",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const dashboardLinks = (html.match(/href="\/dashboard"/g) || []).length;
          return dashboardLinks >= 2; // At least header and footer links
        }
      },
      {
        name: "Home page has proper header structure",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("<header") && html.includes("MCP Gateway");
        }
      },
      {
        name: "Home page has footer with navigation",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("<footer") && html.includes("nav");
        }
      },
      {
        name: "Dashboard button SVG has proper dimensions",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const dashboardButton = html.match(/<a[^>]*href="\/dashboard"[^>]*>[\s\S]*?<\/a>/);
          return dashboardButton && dashboardButton[0].includes("w-4") && dashboardButton[0].includes("h-4");
        }
      },
      {
        name: "Dashboard button SVG has responsive sizes",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const dashboardButton = html.match(/<a[^>]*href="\/dashboard"[^>]*>[\s\S]*?<\/a>/);
          return dashboardButton && dashboardButton[0].includes("sm:w-5") && dashboardButton[0].includes("sm:h-5");
        }
      },
      {
        name: "Home page has hero section with heading",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("MCP Gateway") && html.includes("<h1");
        }
      },
      {
        name: "Home page has quick actions section",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("Quick Actions") || html.includes("quick");
        }
      },
      {
        name: "Home page action buttons have proper styling",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("bg-accent") && html.includes("rounded-lg") && html.includes("px-") && html.includes("py-");
        }
      },
      {
        name: "Home page has API tester form",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("form") || html.includes("input") || html.includes("textarea");
        }
      },
      {
        name: "Home page has responsive grid layout",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("grid") && html.includes("grid-cols-1");
        }
      },
      {
        name: "Home page has dark mode support on main elements",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("dark:bg-") && html.includes("dark:text-");
        }
      },
      {
        name: "Home page uses Tailwind responsive prefixes",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("sm:") && html.includes("md:") && html.includes("lg:");
        }
      },
      {
        name: "Home page has proper button styling",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("hover:") && html.includes("transition-");
        }
      },
      {
        name: "Home page has proper spacing utilities",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("gap-") && html.includes("space-");
        }
      },
      {
        name: "Home page has service cards or sections",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("card") || html.includes("section") || html.includes("Service");
        }
      },
      {
        name: "Home page has proper heading hierarchy",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("<h1") && html.includes("<h2");
        }
      },
      {
        name: "Home page has footer with links",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const footerMatch = html.match(/<footer[\s\S]*?<\/footer>/);
          return footerMatch && footerMatch[0].includes("<a");
        }
      },
      {
        name: "Home page footer has dashboard link",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const footerMatch = html.match(/<footer[\s\S]*?<\/footer>/);
          return footerMatch && footerMatch[0].includes("Dashboard");
        }
      },
      {
        name: "Home page header has proper structure",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const headerMatch = html.match(/<header[\s\S]*?<\/header>/);
          return headerMatch && headerMatch[0].includes("nav") && headerMatch[0].includes("Dashboard");
        }
      },
      {
        name: "Home page buttons have rounded corners",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("rounded-lg") || html.includes("rounded-md") || html.includes("rounded-full");
        }
      },
      {
        name: "Home page has proper touch target sizes",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("p-2") || html.includes("p-3") || html.includes("min-h-");
        }
      },
      {
        name: "Home page buttons have focus outline",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("focus:outline-none") || html.includes("focus:ring");
        }
      },
      {
        name: "Home page uses semantic HTML structure",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("<header") && html.includes("<main") && html.includes("<footer");
        }
      },
      {
        name: "Home page has proper color contrast support",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("text-") && html.includes("bg-") || html.includes("dark:text-");
        }
      },
      {
        name: "Home page content is centered and readable",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("max-w-") || html.includes("container") || html.includes("mx-auto");
        }
      },
      {
        name: "Home page has accessible link labels",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("aria-label") || html.includes("title") || (html.includes("<a") && !html.includes("<a>"));
        }
      },
      {
        name: "Home page has form with proper inputs",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("<input") || html.includes("<textarea") || html.includes("<select");
        }
      },
      {
        name: "Home page inputs have focus states",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("focus:ring") || html.includes("focus:border");
        }
      },
      {
        name: "Home page has proper text hierarchy",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          return html.includes("text-sm") || html.includes("text-lg") || html.includes("text-xl");
        }
      },
      {
        name: "Home page styles are applied to key sections",
        test: async () => {
          const response = await fetch("/");
          const html = await response.text();
          const styleCount = (html.match(/class="/g) || []).length;
          return styleCount > 20; // Ensure sufficient styling applied
        }
      }
    ];

    async function runTests() {
      const resultsDiv = document.getElementById("test-results");
      let passed = 0;
      let failed = 0;

      for (const test of tests) {
        try {
          const result = await test.test();
          const resultDiv = document.createElement("div");
          resultDiv.className = `test-result ${result ? "test-pass" : "test-fail"}`;
          resultDiv.textContent = `${result ? "✓ PASS" : "✗ FAIL"}: ${test.name}`;
          resultsDiv.appendChild(resultDiv);
          
          if (result) passed++;
          else failed++;
        } catch (error) {
          const resultDiv = document.createElement("div");
          resultDiv.className = "test-result test-fail";
          resultDiv.textContent = `✗ ERROR: ${test.name} - ${error.message}`;
          resultsDiv.appendChild(resultDiv);
          failed++;
        }
      }

      // Summary
      const summary = document.createElement("div");
      summary.className = "mt-8 p-4 bg-slate-100 rounded-lg font-bold text-lg";
      summary.textContent = `Tests: ${passed} passed, ${failed} failed (Total: ${tests.length})`;
      resultsDiv.appendChild(summary);

      // Color summary based on results
      if (failed === 0) {
        summary.className += " text-green-700";
      } else {
        summary.className += " text-red-700";
      }
    }

    // Run tests when page loads
    window.addEventListener("load", runTests);
  </script>
</body>
</html>
